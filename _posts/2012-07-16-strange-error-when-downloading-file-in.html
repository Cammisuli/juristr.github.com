---
layout: post
title: "Strange Error When Downloading File in IE8 from SSL Site"
date: 2012-07-16
comments: true
tags: [  ASP.net MVC, Web dev ]
---

<p>A couple of days ago, one of our clients called indicating that he wasn't able to download a file from our server. The file was basically generated on the fly from our ASP.net MVC backend. I tried it and obviously it <a href="http://www.codinghorror.com/blog/2007/03/the-works-on-my-machine-certification-program.html" target="_blank">"worked on my machine"</a>. After quite some investigation it turned out that nice, lovely IE played his role again.</p><blockquote class="tr_bq">Internet Explorer cannot download the &lt;file&gt; from &lt;server&gt;.<br />Internet Explorer was not able to open this Internet site. The requested site is either unavailable or cannot be found. Please try later.</blockquote>The following error basically:<br /><div class="separator" style="clear: both; text-align: center;"><img border="0" height="251" src="http://4.bp.blogspot.com/-hMpyVQhKhTA/T_2IeWDtvvI/AAAAAAAADZw/53dMNZVw6-k/s640/downloaderrorcaching.png" width="640" /></div><br />The ASP.net MVC backend method looked very simple actually, something like:<br /><pre class="brush:csharp">public FileResult GenerateReportForSomeData(FormCollection data)<br />{<br />   //snip snip: call aspose to render the PDF report<br />   return new File(fileData, "application/pdf", filename);<br />}<br /></pre>The JavaScript client fired up the invocation of the url, the browser executed that and got a file download instruction back which worked perfectly in Chrome, Firefox and IE9 (surprisingly). <b>IE8 failed</b>! <br />When inspecting the response headers I got<br /><pre class="brush:bash">Cache-Control: no-cache<br />Content-Disposition: attachment; filename=mygeneratedreport.pdf<br />Content-Length: 76997<br />Content-Type: applictaion/pdf<br />Pragma: no-cache<br />Expires: -1<br /></pre>..and some others. <b>Note the caching headers</b> instructing the browser to <b>not cache</b> the response. Oh yes, I remember, added them to prevent strange side effects, given that we don't want to have caching on our JSON REST Api if not specified explicitly (btw, <a href="http://stackoverflow.com/questions/10892924/overriding-caching-defined-in-global-actionfilter" target="_blank">here's a SO question open if you can answer</a>; I was already successful in fixing this in some 1st trials, but that's another story).<br /><br />But, yep, unsurprisingly it turns out IE really has a problem with cache control headers when downloading files from a SSL protected site:&nbsp;<a href="http://support.microsoft.com/kb/316431">http://support.microsoft.com/kb/316431</a><br /><br />So the solution so far...hacky, but seems to work. In my NoCacheActionFilter I have now something that checks on whether the returned result was some kind of file download and in such case I just <b>don't</b> apply the logic of adding cache-control headers. Any better solution for this?? Plz drop me a line.